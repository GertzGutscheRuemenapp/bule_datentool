<mat-toolbar class="sub-nav">
  <!--  <div fxShow="true" fxHide.gt-sm="true">
      <button mat-icon-button (click)="sidenav.toggle()">
        <mat-icon>menu</mat-icon>
      </button>
    </div>-->
  <ng-template #apTip>
    <b>{{ activeProject?.name }}</b> <br>
    <i>{{ activeProject?.description }}</i>
    <mat-divider></mat-divider>
    <div *ngIf="activeProject?.shared && !activeProject?.user">geteilt mit ...</div>
    <div *ngIf="activeProject?.user">{{(activeProject?.editable)? 'editierbar': 'nicht editierbar'}} <br> geteilt durch <i>{{activeProject?.user}}</i></div>
  </ng-template>
  <span class="sub-links">
    <a routerLink="/planung/nachfrage" routerLinkActive="active-link" i18n> Nachfrage </a>
    <a routerLink="/planung/angebot" routerLinkActive="active-link" i18n> Angebot </a>
    <a routerLink="/planung/erreichbarkeiten" routerLinkActive="active-link" i18n> Erreichbarkeiten </a>
    <a routerLink="/planung/bewertung" routerLinkActive="active-link" i18n> Bewertung </a>
  </span>
</mat-toolbar>
<div class="map-wrapper">
  <div id="planning-map" class="map-container">
    <div id="info" class="map-drag-element" cdkDrag cdkDragBoundary="#planning-map">
      <div class="handle" title="Anzeigeinformationen" cdkDragHandle>
        <mat-icon color="primary">info</mat-icon>
        <fa-icon class="drag-indicator" matSuffix [icon]="faArrows"></fa-icon>
      </div>
      <app-side-toggle [fullHeightIndicator]="true" cookieExpansion="exp-planning-description" [cookieExpansionInit]="true">
        <div style="padding: 10px; min-height: 70px;" [innerHTML]="this.mapControl?.mapDescription"></div>
      </app-side-toggle>
    </div>
    <div id="time-slider" class="map-drag-element" cdkDrag cdkDragBoundary="#planning-map">
      <div class="handle" title="Anzeigezeit" cdkDragHandle>
        <mat-icon color="primary">event</mat-icon>
        <fa-icon class="drag-indicator" matSuffix [icon]="faArrows"></fa-icon>
      </div>
      <app-side-toggle [fullHeightIndicator]="true" cookieExpansion="exp-planning-timeslider" [cookieExpansionInit]="true">
        <div style="padding: 18px 10px 12px 10px">
          <app-time-slider [prognosisEnd]="2013" [years]="[2009, 2010, 2012, 2013, 2015, 2017, 2020, 2025]"></app-time-slider>
        </div>
      </app-side-toggle>
    </div>
    <app-map-controls></app-map-controls>
  </div>
</div>
<mat-sidenav #drawer class="context-bar"
             [opened]="(isSM$ | async) === false">
  <div id="process-select">
    <div class="mini-fab-icon inverted primary">
      <div class="davicon icon-GGR-davicons-Font-Simple-1-Planungsprozess"></div>
    </div>
    <mat-form-field appearance="standard" class="small">
      <mat-label>Planungsprozess</mat-label>
      <mat-select disableOptionCentering
                  [tooltip]="(activeProject)? $any(apTip): ''" contentType="template"
                  [hideDelay]="0"
                  tooltipClass="context-tooltip"
                  theme="light"
                  maxWidth="400px"
                  placement="right"
                  panelClass="custom-option-panel"
                  (selectionChange)="onProcessChange($event.value)">
        <mat-select-trigger>
          <span *ngIf="activeProject">
            {{ activeProject.name }}
          </span>
        </mat-select-trigger>
        <mat-optgroup label="Meine Planungsprozesse">
          <button title="Planungsprozess erstellen"
                  mat-icon-button color="primary"
                  style="position: absolute; right: 7px; top: 5px;"
                  (click)="onEditProcess(true)">
            <mat-icon>add</mat-icon>
          </button>
          <mat-option *ngFor="let project of myProjects"
                      tooltip="{{(project.description)? '<i>' + project.description + '</i><br>' : ''}} {{(project.shared)? 'geteilt mit ...': ''}}"
                      theme="light"
                      [value]="project.id"
                      [hideDelay]="0"
                      class="custom-option"
                      tooltipClass="context-tooltip"
                      placement="right">
            <div class="option-title">
              {{project.name}}
            </div>
            <div class="option-controls">
              <button mat-icon-button color="primary"
                      (click)="$event.stopPropagation()"
                      title="Planungsprozess editieren">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="primary"
                      (click)="$event.stopPropagation()"
                      title="Planungsprozess löschen">
                <mat-icon>remove</mat-icon>
              </button>
            </div>
          </mat-option>
        </mat-optgroup>
        <mat-optgroup *ngIf="sharedProjects" label="Geteilte Planungsprozesse">
          <mat-option *ngFor="let project of sharedProjects"
                      [value]="project.id"
                      tooltip="{{(project.description)? '<i>' + project.description + '</i><br>' : ''}} {{(project.editable)? 'editierbar': 'nicht editierbar'}} <br> geteilt durch <i>{{project.user}}</i>"
                      [hideDelay]="0"
                      tooltipClass="context-tooltip"
                      theme="light"
                      maxWidth="400px"
                      placement="right">
            {{ project.name }}
          </mat-option>
        </mat-optgroup>
      </mat-select>
    </mat-form-field>
    <button mat-icon-button color="primary"
            title="Hilfe"
            tooltip="Wählen Sie hier den Planungsprozess aus. Mit einem Klick auf das Stift-Symbol können Sie den ausgewählten Planungsprozess editieren. Über das Plus-Symbol können Sie Planungsprozesse hinzufügen."
            [hideDelay]="3000"
            trigger="click"
            tooltipClass="context-tooltip"
            theme="light"
            maxWidth="300px">
      <mat-icon>help_outline</mat-icon>
    </button>
    <button *ngIf="activeProject" class="process-button"
            title="ausgewählten Planungsprozess editieren"
            mat-icon-button color="primary"
            (click)="onEditProcess()" i18n>
      <mat-icon>edit</mat-icon>
    </button>
    <button *ngIf="!activeProject" class="process-button"
            title="Planungsprozess erstellen"
            mat-icon-button color="primary"
            (click)="onEditProcess(true)" i18n>
      <mat-icon>add</mat-icon>
    </button>
  </div>
  <router-outlet>
  </router-outlet>
</mat-sidenav>
<button type="button"
        id="toggle-settings"
        aria-label="Toggle sidenav"
        mat-icon-button
        color="primary"
        (click)="drawer.toggle()"
        *ngIf="isSM$ | async">
  <mat-icon aria-label="Side nav toggle icon">arrow_circle_down</mat-icon>
</button>

<app-side-toggle id="legend"
                 icon="layers"
                 name="Legenden- und Layersteuerung"
                 direction="left"
                 cookieExpansion="exp-planning-legend" [cookieExpansionInit]="true">
  <app-legend target="planning-map"></app-legend>
</app-side-toggle>

<ng-template #processTemplate>
  <div fxLayout="row wrap">
    <div fxLayout="column" fxFlex="50%" style="padding: 10px;">
      <mat-form-field appearance="fill">
        <mat-label i18n>Name</mat-label>
        <input matInput [value]="!createProcess? activeProject?.name: ''">
      </mat-form-field>
    </div>
    <div fxLayout="column" fxFlex="50%" style="padding: 10px;">
      <mat-form-field appearance="fill">
        <mat-label i18n>Beschreibung</mat-label>
        <textarea matInput rows="3" [value]="!createProcess? activeProject?.description: ''"></textarea>
      </mat-form-field>
    </div>
  </div>
  <mat-divider style="width: 100%; margin-bottom: 10px;"></mat-divider>
  <div fxLayout="row wrap">
    <div fxLayout="column" fxFlex="50%" style="padding: 10px;">
      <span class="subtitle1" style="color: grey;">Infrastrukturbereiche</span>
      <div class="border-box" style="height: 250px;">
        <mat-checkbox class="reverse" color="primary">alle</mat-checkbox>
        <mat-divider style="margin-bottom: 10px;"></mat-divider>
        <mat-checkbox class="reverse" color="primary" *ngFor="let infrastructure of infrastructures">
          {{infrastructure.name}}
        </mat-checkbox>
      </div>
    </div>
    <div fxLayout="column" fxFlex="50%" style="padding: 10px;">
      <span class="subtitle1" style="color: grey;">Zugriff auf Planungsprozess</span>
      <div class="border-box" style="height: 250px;">
        <mat-checkbox class="reverse" color="primary" *ngFor="let user of users">
          {{user.firstName + ' ' + user.lastName}}
        </mat-checkbox>
      </div>
      <mat-checkbox style="margin-top: 10px;" color="primary">Änderungen an Planungsprozess erlauben</mat-checkbox>
    </div>
  </div>
</ng-template>
