<app-scenario-menu domain="rating" [ngClass]="{'expanded': showScenarioMenu}"></app-scenario-menu>
<mat-expansion-panel class="side-toggle" id="scenario-toggle" cookieExpansion="exp-planning-scenario">
  <mat-expansion-panel-header (click)="showScenarioMenu=!showScenarioMenu;">
    <mat-panel-title>
      <div class="mini-fab-icon" [ngClass]="{'primary': showScenarioMenu}">
        <div class="davicon icon-GGR-davicons-Font-Simple-2-Szenario"></div>
      </div>
      Szenario
    </mat-panel-title>
  </mat-expansion-panel-header>
</mat-expansion-panel>
<mat-expansion-panel cookieExpansion="exp-rating-indicators">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <div class="mini-fab-icon">
        <mat-icon class="material-icons-outlined">lightbulb</mat-icon>
      </div>
      Indikator
    </mat-panel-title>
  </mat-expansion-panel-header>
  <mat-form-field appearance="outline" class="small">
    <mat-select disableOptionCentering panelClass="custom-option-panel"
                disableRipple
                (selectionChange)="onIndicatorChange($event.value)"
                [value]="activeIndicator.id"
                [ngbPopover]="activeIndicator?.description"
                placement="right"
                container="body"
                triggers="mouseenter:mouseleave">
      <mat-select-trigger>
        <span *ngIf="activeIndicator">
          {{ activeIndicator.name }}
        </span>
      </mat-select-trigger>
      <mat-optgroup label="Meine Indikatoren">
        <button mat-icon-button color="primary" class="small"
                title="Indikator hinzufügen"
                style="position: absolute; right: 6px; top: 5px;">
          <mat-icon>add</mat-icon>
        </button>
        <mat-option *ngFor="let indicator of customIndicators"
                    [value]="indicator.id"
                    class="custom-option"
                    [ngbPopover]="indicator.description"
                    placement="right"
                    container="body"
                    triggers="mouseenter:mouseleave">
          <div class="option-title">
            {{indicator.name}}
          </div>
          <div class="option-controls">
            <button mat-icon-button color="primary" class="small"
                    (click)="$event.stopPropagation()"
                    title="Indikator editieren">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="primary" class="small"
                    (click)="$event.stopPropagation()"
                    title="Indikator löschen">
              <mat-icon>remove</mat-icon>
            </button>
          </div>
        </mat-option>
      </mat-optgroup>
      <mat-optgroup label="Vorgegebene Indikatoren">
        <mat-option *ngFor="let indicator of indicators"
                    [value]="indicator.id"
                    [ngbPopover]="indicator.description"
                    placement="right"
                    container="body"
                    triggers="mouseenter:mouseleave">
          {{indicator.name}}
        </mat-option>
      </mat-optgroup>
    </mat-select>
  </mat-form-field>
  <mat-expansion-panel class="text-panel">
    <mat-expansion-panel-header>
      <mat-icon color="primary" class="material-icons-outlined"
                style="margin-right: 5px;">help_outline</mat-icon>
      <span class="subtitle1">Hilfe</span>
    </mat-expansion-panel-header>
    <span class="info-text">
      <p>Wählen Sie hier aus den definierten Indikatoren für die Darstellung aus. Sie können hier zudem eigene Indikatoren hinzufügen oder löschen.</p>
    </span>
  </mat-expansion-panel>
</mat-expansion-panel>
<mat-expansion-panel cookieExpansion="exp-rating-areas">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <div class="mini-fab-icon">
        <mat-icon class="material-icons-outlined">flip_to_front</mat-icon>
      </div>
      Gebietseinheit
    </mat-panel-title>
  </mat-expansion-panel-header>
  <mat-form-field appearance="outline" class="small">
    <mat-select disableOptionCentering disableRipple [value]="areaLevels[0]">
      <mat-option [value]="areaLevel" *ngFor="let areaLevel of areaLevels">
        {{areaLevel.name}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-expansion-panel class="text-panel">
    <mat-expansion-panel-header>
      <mat-icon color="primary" class="material-icons-outlined"
                style="margin-right: 5px;">help_outline</mat-icon>
      <span class="subtitle1">Hilfe</span>
    </mat-expansion-panel-header>
    <span class="info-text">
      <p>Wählen Sie hier im Dropdown-Menü die jeweilige Gebietseinheit für die Darstellung aus.</p>
    </span>
  </mat-expansion-panel>
</mat-expansion-panel>
<mat-expansion-panel cookieExpansion="exp-rating-compare">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <div class="mini-fab-icon">
        <div class="davicon icon-GGR-davicons-Font-Simple-4-Vergleichsdarstellung"></div>
      </div>
      Vergleichsdarstellung
    </mat-panel-title>
  </mat-expansion-panel-header>
  <mat-checkbox style="padding-left: 12px;" color="primary" [(ngModel)]="compareSupply" i18n> <!--style="margin-left: -12px"-->
    Nachfrage vergleichen
  </mat-checkbox>
  <div class="sub-select-wrapper compare-radio-list">
    <mat-radio-group [(ngModel)]="compareStatus">
      <mat-radio-button value="option 1" color="primary"
                        [disabled]="!compareSupply"
                        i18n>
        Mit Bewertung im gleichen Szenario im Jahr
      </mat-radio-button>
      <mat-form-field appearance="outline" class="small">
        <mat-select disableOptionCentering disableRipple [value]="years[0]" [disabled]="!compareSupply || compareStatus != 'option 1'">
          <mat-option *ngFor="let year of years" [value]="year">
            {{year}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-radio-button value="option 2" color="primary"
                        [disabled]="!compareSupply"
                        i18n>
        Mit Bewertung im gleichen Jahr im Szenario
      </mat-radio-button>
      <mat-form-field appearance="outline" class="small">
        <mat-select disableOptionCentering disableRipple value="1" [disabled]="!compareSupply || compareStatus != 'option 2'">
          <mat-option value="1">
            Szenario 1
          </mat-option>
          <mat-option value="2">
            Szenario 2
          </mat-option>
        </mat-select>
      </mat-form-field>
    </mat-radio-group>
  </div>
</mat-expansion-panel>
<app-side-toggle id="chart-toggle" icon="bar_chart" name="Diagramm"
                 cookieExpansion="exp-rating-diagram">
  <div class="diagram-wrapper">
    <img src="{{backend}}/static/img/Indikator U3 Screenshot.png" width="500px">
    <div class="diagram-controls">
      <button mat-mini-fab
              class="small"
              color="primary"
              title="Diagramm vergrößert darstellen"
              (click)="onFullscreenDialog()">
        <mat-icon>fullscreen</mat-icon>
      </button>
      <br>
      <button mat-mini-fab
              class="small"
              style="margin: 5px 0;"
              color="primary"
              title="Diagramm als Bilddatei herunterladen">
        <mat-icon style="font-size: 20px; margin-top: 0;">download</mat-icon>
      </button>
      <br>
      <app-help-button title="Diagrammdarstellung" position="right">
        <p>Das Diagramm zeigt die Kennwerte des ausgewählten Indikators für alle Gebiete der ausgewählten Gebietseinheit.</p>
        <p>Mit einem Klick auf den Vollbild-Button rechts oben können Sie sich das Diagramm vergrößert in einem Dialog anzeigen lassen.</p>
        <p>Über den Herunterladen-Button darunter können Sie sich das Diagramm als Bild (PNG) herunterladen.</p>
      </app-help-button>
    </div>
  </div>
</app-side-toggle>

<ng-template #diagramDialog>
  <div style="overflow-y: auto; max-height: 80vh;">
    <img src="{{backend}}/static/img/Indikator U3 Screenshot.png" width="100%">
  </div>
  <div style="width: 100%; display: flex; justify-content: center;">
    <app-time-slider id="time-slider" [prognosisEnd]="2013" [years]="[2009, 2010, 2012, 2013, 2015, 2017, 2020, 2025]"></app-time-slider>
  </div>
</ng-template>
